ARG FLINK_VERSION
ARG JDK_VERSION
ARG SCALA_VERSION={:-"2.12"}

FROM openjdk:${JDK_VERSION}-jdk

WORKDIR /app
ADD https://archive.apache.org/dist/flink/flink-${FLINK_VERSION}/flink-${FLINK_VERSION}-bin-scala_${SCALA_VERSION}.tgz /tmp

COPY ./build/dlink-release-*.tar.gz .
RUN mkdir /tmp/dist &  \
    tar zxvf /tmp/flink-${FLINK_VERSION}-bin-scala_${SCALA_VERSION}.tgz -C /app --strip-components=1 & \
    mv /app/lib /app/plugins & \
    zxvf ./build/dlink-release-*.tar.gz -C /app --strip-components=1

CMD [ "/bin/sh", "-c", "java -Dloader.path=./lib,./plugins -Ddruid.mysql.usePingMethod=false -jar -Xms512M -Xmx2048M ./dlink-admin-*.jar" ]
